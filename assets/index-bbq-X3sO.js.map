{"version":3,"file":"index-bbq-X3sO.js","sources":["../../src/assets/icon/HomePin.svg","../../src/Pages/Supportnursing/Dashboards/Components/Mapview/index.jsx"],"sourcesContent":["export default \"data:image/svg+xml,%3csvg%20width='22'%20height='22'%20viewBox='0%200%2022%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.8'%20clip-path='url(%23clip0_2_16)'%3e%3cpath%20d='M13.75%2020.1667C13.5069%2020.1667%2013.2737%2020.0701%2013.1018%2019.8982C12.9299%2019.7263%2012.8333%2019.4931%2012.8333%2019.25V15.5833C12.8333%2015.4325%2012.8705%2015.2839%2012.9417%2015.1509C13.0128%2015.0178%2013.1157%2014.9044%2013.2413%2014.8207L15.9913%2012.9873C16.1419%2012.8868%2016.3189%2012.8332%2016.5%2012.8332C16.6811%2012.8332%2016.8581%2012.8868%2017.0088%2012.9873L19.7588%2014.8207C19.8843%2014.9044%2019.9872%2015.0178%2020.0583%2015.1509C20.1295%2015.2839%2020.1667%2015.4325%2020.1667%2015.5833V19.25C20.1667%2019.4931%2020.0701%2019.7263%2019.8982%2019.8982C19.7263%2020.0701%2019.4931%2020.1667%2019.25%2020.1667H13.75Z'%20stroke='%23140050'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M16.5%209.16667C16.5%207.22175%2015.7274%205.35648%2014.3521%203.98122C12.9769%202.60595%2011.1116%201.83333%209.16667%201.83333C7.22175%201.83333%205.35648%202.60595%203.98122%203.98122C2.60595%205.35648%201.83333%207.22175%201.83333%209.16667C1.83333%2013.7436%206.91075%2018.5102%208.61575%2019.9824C8.77467%2020.1016%208.96801%2020.1659%209.16667%2020.1657'%20stroke='%23140050'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M16.5%2020.1667V17.4167'%20stroke='%23140050'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9.16667%2011.9167C10.6855%2011.9167%2011.9167%2010.6855%2011.9167%209.16667C11.9167%207.64788%2010.6855%206.41667%209.16667%206.41667C7.64788%206.41667%206.41667%207.64788%206.41667%209.16667C6.41667%2010.6855%207.64788%2011.9167%209.16667%2011.9167Z'%20stroke='%23140050'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_2_16'%3e%3crect%20width='22'%20height='22'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e\"","import {\n  forwardRef,\n  useContext,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from \"react\";\nimport { MapContainer, TileLayer, Marker, Popup } from \"react-leaflet\";\nimport L from \"leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport { LuNavigation } from \"react-icons/lu\";\nimport HomePinIcon from \"@/assets/icon/HomePin.svg\";\nimport { useNavigate } from \"react-router-dom\";\nimport { getAlertList } from \"@/api/elderlySupport\";\nimport Slider from \"react-slick\";\nimport \"slick-carousel/slick/slick.css\";\nimport \"slick-carousel/slick/slick-theme.css\";\nimport dayjs from \"dayjs\";\nimport { getAlertType } from \"@/utils/helper\";\nimport { useNotification } from \"@/Context/useNotification\";\nimport { SidebarContext } from \"@/Context/CustomUsertable\";\n// Custom pin icons for different statuses\nconst getIcon = (status) => {\n  const colorClasses = {\n    critical: \"bg-red-500\",\n    warning: \"bg-yellow-500\",\n    problem: \"bg-blue-500\",\n  };\n\n  const animationClasses = {\n    critical: \"animate-ping-critical\",\n    warning: \"animate-ping-warning\",\n    problem: \"animate-ping-problem\",\n  };\n\n  return L.divIcon({\n    className: \"\",\n    html: `\n      <div class=\"relative flex justify-center items-center\">\n        <div class=\"${animationClasses[status]} absolute h-8 w-8 rounded-full ${colorClasses[status]} opacity-75\"></div>\n        <div class=\"scale-150 h-3 w-4 ${colorClasses[status]} rounded-full\"></div>\n      </div>\n    `,\n  });\n};\n\nfunction MapView({ height = 490 }, ref) {\n  const navigate = useNavigate();\n  const sliderSettings = {\n    dots: true,\n    infinite: true,\n    speed: 500,\n    slidesToShow: 1,\n    slidesToScroll: 1,\n    autoplay: true,\n    autoplaySpeed: 1000,\n    pauseOnHover: true,\n  };\n  const [alertList, setAlertList] = useState([]);\n  const { notificationEvent } = useNotification();\n\n  function getAlertListData() {\n    console.log(\"referes\");\n\n    getAlertList({\n      to_date: \"2025-05-25\",\n      from_date: dayjs().format(\"YYYY-MM-DD\"),\n      is_resolved: false,\n      event: [2, 3, 5, 9, 8].join(\",\"),\n      alarm_type: [11, 12, 14, 15, 16, 1, 3, 13, 2].join(\",\"),\n      is_online: 1,\n      recovery: 0,\n    })\n      .then((res) => {\n        if (res.data.length > 0) {\n          setAlertList(res.data);\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  useEffect(() => {\n    getAlertListData();\n  }, []);\n  useImperativeHandle(ref, () => ({\n    getAlertListData,\n  }));\n  useEffect(() => {\n    if (notificationEvent) {\n      getAlertListData();\n    }\n  }, [notificationEvent]);\n  // Group alerts by elderly_id and sort by priority\n  const groupedAlerts = Object.values(\n    alertList.reduce((acc, alert) => {\n      if (!acc[alert.elderly_id]) {\n        acc[alert.elderly_id] = [];\n      }\n      acc[alert.elderly_id].push(alert);\n      return acc;\n    }, {})\n  ).reduce((acc, alerts) => {\n    // Sort alerts by priority: Critical > Warning > Problem\n    const priorityOrder = { Critical: 3, Warning: 2, Problem: 1 };\n    alerts.sort(\n      (a, b) => priorityOrder[getAlertType(b)] - priorityOrder[getAlertType(a)]\n    );\n    acc[alerts[0].elderly_id] = alerts;\n    return acc;\n  }, {});\n\n  // Function to determine the highest-priority alert type\n  const getHighestPriorityType = (alerts) => {\n    const priorityOrder = { Critical: 3, Warning: 2, Problem: 1 };\n    return alerts\n      .reduce((highest, alert) => {\n        const type = getAlertType(alert);\n        return priorityOrder[type] > priorityOrder[highest] ? type : highest;\n      }, \"Problem\")\n      .toLowerCase();\n  };\n\n  return (\n    <div className=\"w-full !z-0\" style={{ height: height + \"px\" }}>\n      <MapContainer\n        center={[51.505, -0.09]}\n        zoom={2}\n        zoomControl={false}\n        style={{ height: \"100%\", width: \"100%\" }}\n        className=\"!w-full rounded-[8px] overflow-hidden !outline-none z-0\"\n      >\n        <TileLayer\n          url=\"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png\"\n          attribution='© <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors © <a href=\"https://carto.com/attributions\">CARTO</a>'\n        />\n\n        {/* Single loop through grouped alerts with prioritized alert type */}\n        {Object.entries(groupedAlerts).map(([elderlyId, alerts]) => (\n          <Marker\n            key={elderlyId}\n            position={[alerts[0].latitude || 0, alerts[0].longitude || 0]}\n            icon={getIcon(getHighestPriorityType(alerts))}\n          >\n            <style>\n              {`\n                .slick-dots {\n                  margin-bottom: 20px;\n                }\n              `}\n            </style>\n            <Popup className=\"w-[350px] !drop-shadow-2xl shadow-none !pb-6\">\n              <Slider {...sliderSettings}>\n                {alerts.map((alert, index) => (\n                  <div\n                    key={index}\n                    className=\"!flex w-full flex-col !gap-6 font-baloo pt-2 pb-4\"\n                  >\n                    <div className=\"flex font-baloo cursor-pointer\">\n                      <div\n                        className=\"flex flex-col w-full\"\n                        onClick={() => {\n                          navigate(\"/support-nurnt/dashboard/alarm-detail\", {\n                            state: { alertData: alert, id: alert?.elderly_id },\n                          });\n                        }}\n                      >\n                        <h1 className=\"font-bold text-xl text-text-primary\">\n                          {alert.elderly_name}\n                        </h1>\n                        <span className=\"font-normal text-base text-text-primary\">\n                          Age: <b>{alert.age || \"-\"}</b>\n                        </span>\n                      </div>\n                      <div\n                        className={`p-4 py-3 leading-none font-semibold text-base h-fit ${\n                          getAlertType(alert) === \"Critical\"\n                            ? \"bg-red-100 text-red-500\"\n                            : getAlertType(alert) === \"Warning\"\n                            ? \"bg-yellow-100 text-yellow-600\"\n                            : \"bg-blue-100 text-blue-500\"\n                        } w-fit text-nowrap rounded-full flex items-center justify-center capitalize`}\n                      >\n                        {getAlertType(alert) === \"Critical\"\n                          ? \"Critical Alert\"\n                          : getAlertType(alert) === \"Warning\"\n                          ? \"Warning Alert\"\n                          : \"Problem Alert\"}\n                      </div>\n                    </div>\n                    <div className=\"flex flex-col items-center justify-center cursor-pointer\">\n                      <h1 className=\"font-bold text-2xl text-text-primary !m-0\">\n                        {alert.room_name || \"-\"}\n                      </h1>\n                      <p className=\"font-normal text-lg text-text-primary !m-0\">\n                        Location of Incident\n                      </p>\n                    </div>\n                    <div className=\"flex flex-col gap-1\">\n                      <div className=\"flex items-start gap-2\">\n                        <img width={22} height={22} src={HomePinIcon} alt=\"\" />\n                        <p className=\"!m-0 !mt-[2px] font-medium text-base text-text-primary/80\">\n                          {alert.address || \"-\"}\n                        </p>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <a\n                          href={`https://www.google.com/maps?q=${alert.latitude},${alert.longitude}`}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"text-base font-medium !text-blue-500\"\n                        >\n                          View on Google Maps\n                        </a>\n                        <LuNavigation size={18} className=\"text-blue-500\" />\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </Slider>\n            </Popup>\n          </Marker>\n        ))}\n      </MapContainer>\n    </div>\n  );\n}\nexport default forwardRef(MapView);\n"],"names":["HomePinIcon","getIcon","status","colorClasses","animationClasses","L","MapView","height","ref","navigate","useNavigate","sliderSettings","alertList","setAlertList","useState","notificationEvent","useNotification","getAlertListData","getAlertList","dayjs","res","err","useEffect","useImperativeHandle","groupedAlerts","acc","alert","alerts","priorityOrder","b","getAlertType","getHighestPriorityType","highest","type","jsx","jsxs","MapContainer","TileLayer","elderlyId","Marker","Popup","Slider","index","LuNavigation","forwardRef"],"mappings":"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"}