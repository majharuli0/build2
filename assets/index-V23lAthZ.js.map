{"version":3,"file":"index-V23lAthZ.js","sources":["../../src/assets/icon/HomePin.svg","../../src/Pages/Supportnursing/Dashboards/Components/Mapview/index.jsx"],"sourcesContent":["export default \"data:image/svg+xml,%3csvg%20width='22'%20height='22'%20viewBox='0%200%2022%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.8'%20clip-path='url(%23clip0_2_16)'%3e%3cpath%20d='M13.75%2020.1667C13.5069%2020.1667%2013.2737%2020.0701%2013.1018%2019.8982C12.9299%2019.7263%2012.8333%2019.4931%2012.8333%2019.25V15.5833C12.8333%2015.4325%2012.8705%2015.2839%2012.9417%2015.1509C13.0128%2015.0178%2013.1157%2014.9044%2013.2413%2014.8207L15.9913%2012.9873C16.1419%2012.8868%2016.3189%2012.8332%2016.5%2012.8332C16.6811%2012.8332%2016.8581%2012.8868%2017.0088%2012.9873L19.7588%2014.8207C19.8843%2014.9044%2019.9872%2015.0178%2020.0583%2015.1509C20.1295%2015.2839%2020.1667%2015.4325%2020.1667%2015.5833V19.25C20.1667%2019.4931%2020.0701%2019.7263%2019.8982%2019.8982C19.7263%2020.0701%2019.4931%2020.1667%2019.25%2020.1667H13.75Z'%20stroke='%23140050'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M16.5%209.16667C16.5%207.22175%2015.7274%205.35648%2014.3521%203.98122C12.9769%202.60595%2011.1116%201.83333%209.16667%201.83333C7.22175%201.83333%205.35648%202.60595%203.98122%203.98122C2.60595%205.35648%201.83333%207.22175%201.83333%209.16667C1.83333%2013.7436%206.91075%2018.5102%208.61575%2019.9824C8.77467%2020.1016%208.96801%2020.1659%209.16667%2020.1657'%20stroke='%23140050'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M16.5%2020.1667V17.4167'%20stroke='%23140050'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9.16667%2011.9167C10.6855%2011.9167%2011.9167%2010.6855%2011.9167%209.16667C11.9167%207.64788%2010.6855%206.41667%209.16667%206.41667C7.64788%206.41667%206.41667%207.64788%206.41667%209.16667C6.41667%2010.6855%207.64788%2011.9167%209.16667%2011.9167Z'%20stroke='%23140050'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_2_16'%3e%3crect%20width='22'%20height='22'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e\"","import {\r\n  forwardRef,\r\n  useContext,\r\n  useEffect,\r\n  useImperativeHandle,\r\n  useState,\r\n} from \"react\";\r\nimport { MapContainer, TileLayer, Marker, Popup } from \"react-leaflet\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport { LuNavigation } from \"react-icons/lu\";\r\nimport HomePinIcon from \"@/assets/icon/HomePin.svg\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { getAlertList } from \"@/api/elderlySupport\";\r\nimport Slider from \"react-slick\";\r\nimport \"slick-carousel/slick/slick.css\";\r\nimport \"slick-carousel/slick/slick-theme.css\";\r\nimport dayjs from \"dayjs\";\r\nimport { getAlertType } from \"@/utils/helper\";\r\nimport { useNotification } from \"@/Context/useNotification\";\r\nimport { SidebarContext } from \"@/Context/CustomUsertable\";\r\n// Custom pin icons for different statuses\r\nconst getIcon = (status) => {\r\n  const colorClasses = {\r\n    critical: \"bg-red-500\",\r\n    warning: \"bg-yellow-500\",\r\n    problem: \"bg-blue-500\",\r\n  };\r\n\r\n  const animationClasses = {\r\n    critical: \"animate-ping-critical\",\r\n    warning: \"animate-ping-warning\",\r\n    problem: \"animate-ping-problem\",\r\n  };\r\n\r\n  return L.divIcon({\r\n    className: \"\",\r\n    html: `\r\n      <div class=\"relative flex justify-center items-center\">\r\n        <div class=\"${animationClasses[status]} absolute h-8 w-8 rounded-full ${colorClasses[status]} opacity-75\"></div>\r\n        <div class=\"scale-150 h-3 w-4 ${colorClasses[status]} rounded-full\"></div>\r\n      </div>\r\n    `,\r\n  });\r\n};\r\n\r\nfunction MapView({ height = 490 }, ref) {\r\n  const navigate = useNavigate();\r\n  const sliderSettings = {\r\n    dots: true,\r\n    infinite: true,\r\n    speed: 500,\r\n    slidesToShow: 1,\r\n    slidesToScroll: 1,\r\n    autoplay: true,\r\n    autoplaySpeed: 1000,\r\n    pauseOnHover: true,\r\n  };\r\n  const [alertList, setAlertList] = useState([]);\r\n  const { notificationEvent } = useNotification();\r\n\r\n  function getAlertListData() {\r\n    console.log(\"referes\");\r\n\r\n    getAlertList({\r\n      to_date: \"2025-05-25\",\r\n      from_date: dayjs().format(\"YYYY-MM-DD\"),\r\n      is_resolved: false,\r\n      event: [2, 3, 5, 9, 8].join(\",\"),\r\n      alarm_type: [11, 12, 14, 15, 16, 1, 3, 13, 2].join(\",\"),\r\n      is_online: 1,\r\n      recovery: 0,\r\n    })\r\n      .then((res) => {\r\n        if (res.data.length > 0) {\r\n          setAlertList(res.data);\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  }\r\n\r\n  useEffect(() => {\r\n    getAlertListData();\r\n  }, []);\r\n  useImperativeHandle(ref, () => ({\r\n    getAlertListData,\r\n  }));\r\n  useEffect(() => {\r\n    if (notificationEvent) {\r\n      getAlertListData();\r\n    }\r\n  }, [notificationEvent]);\r\n  // Group alerts by elderly_id and sort by priority\r\n  const groupedAlerts = Object.values(\r\n    alertList.reduce((acc, alert) => {\r\n      if (!acc[alert.elderly_id]) {\r\n        acc[alert.elderly_id] = [];\r\n      }\r\n      acc[alert.elderly_id].push(alert);\r\n      return acc;\r\n    }, {})\r\n  ).reduce((acc, alerts) => {\r\n    // Sort alerts by priority: Critical > Warning > Problem\r\n    const priorityOrder = { Critical: 3, Warning: 2, Problem: 1 };\r\n    alerts.sort(\r\n      (a, b) => priorityOrder[getAlertType(b)] - priorityOrder[getAlertType(a)]\r\n    );\r\n    acc[alerts[0].elderly_id] = alerts;\r\n    return acc;\r\n  }, {});\r\n\r\n  // Function to determine the highest-priority alert type\r\n  const getHighestPriorityType = (alerts) => {\r\n    const priorityOrder = { Critical: 3, Warning: 2, Problem: 1 };\r\n    return alerts\r\n      .reduce((highest, alert) => {\r\n        const type = getAlertType(alert);\r\n        return priorityOrder[type] > priorityOrder[highest] ? type : highest;\r\n      }, \"Problem\")\r\n      .toLowerCase();\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full !z-0\" style={{ height: height + \"px\" }}>\r\n      <MapContainer\r\n        center={[51.505, -0.09]}\r\n        zoom={2}\r\n        zoomControl={false}\r\n        style={{ height: \"100%\", width: \"100%\" }}\r\n        className=\"!w-full rounded-[8px] overflow-hidden !outline-none z-0\"\r\n      >\r\n        <TileLayer\r\n          url=\"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png\"\r\n          attribution='© <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors © <a href=\"https://carto.com/attributions\">CARTO</a>'\r\n        />\r\n\r\n        {/* Single loop through grouped alerts with prioritized alert type */}\r\n        {Object.entries(groupedAlerts).map(([elderlyId, alerts]) => (\r\n          <Marker\r\n            key={elderlyId}\r\n            position={[alerts[0].latitude || 0, alerts[0].longitude || 0]}\r\n            icon={getIcon(getHighestPriorityType(alerts))}\r\n          >\r\n            <style>\r\n              {`\r\n                .slick-dots {\r\n                  margin-bottom: 20px;\r\n                }\r\n              `}\r\n            </style>\r\n            <Popup className=\"w-[350px] !drop-shadow-2xl shadow-none !pb-6\">\r\n              <Slider {...sliderSettings}>\r\n                {alerts.map((alert, index) => (\r\n                  <div\r\n                    key={index}\r\n                    className=\"!flex w-full flex-col !gap-6 font-baloo pt-2 pb-4\"\r\n                  >\r\n                    <div className=\"flex font-baloo cursor-pointer\">\r\n                      <div\r\n                        className=\"flex flex-col w-full\"\r\n                        onClick={() => {\r\n                          navigate(\"/support-nurnt/dashboard/alarm-detail\", {\r\n                            state: { alertData: alert, id: alert?.elderly_id },\r\n                          });\r\n                        }}\r\n                      >\r\n                        <h1 className=\"font-bold text-xl text-text-primary\">\r\n                          {alert.elderly_name}\r\n                        </h1>\r\n                        <span className=\"font-normal text-base text-text-primary\">\r\n                          Age: <b>{alert.age || \"-\"}</b>\r\n                        </span>\r\n                      </div>\r\n                      <div\r\n                        className={`p-4 py-3 leading-none font-semibold text-base h-fit ${\r\n                          getAlertType(alert) === \"Critical\"\r\n                            ? \"bg-red-100 text-red-500\"\r\n                            : getAlertType(alert) === \"Warning\"\r\n                            ? \"bg-yellow-100 text-yellow-600\"\r\n                            : \"bg-blue-100 text-blue-500\"\r\n                        } w-fit text-nowrap rounded-full flex items-center justify-center capitalize`}\r\n                      >\r\n                        {getAlertType(alert) === \"Critical\"\r\n                          ? \"Critical Alert\"\r\n                          : getAlertType(alert) === \"Warning\"\r\n                          ? \"Warning Alert\"\r\n                          : \"Problem Alert\"}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex flex-col items-center justify-center cursor-pointer\">\r\n                      <h1 className=\"font-bold text-2xl text-text-primary !m-0\">\r\n                        {alert.room_name || \"-\"}\r\n                      </h1>\r\n                      <p className=\"font-normal text-lg text-text-primary !m-0\">\r\n                        Location of Incident\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"flex flex-col gap-1\">\r\n                      <div className=\"flex items-start gap-2\">\r\n                        <img width={22} height={22} src={HomePinIcon} alt=\"\" />\r\n                        <p className=\"!m-0 !mt-[2px] font-medium text-base text-text-primary/80\">\r\n                          {alert.address || \"-\"}\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <a\r\n                          href={`https://www.google.com/maps?q=${alert.latitude},${alert.longitude}`}\r\n                          target=\"_blank\"\r\n                          rel=\"noopener noreferrer\"\r\n                          className=\"text-base font-medium !text-blue-500\"\r\n                        >\r\n                          View on Google Maps\r\n                        </a>\r\n                        <LuNavigation size={18} className=\"text-blue-500\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </Slider>\r\n            </Popup>\r\n          </Marker>\r\n        ))}\r\n      </MapContainer>\r\n    </div>\r\n  );\r\n}\r\nexport default forwardRef(MapView);\r\n"],"names":["HomePinIcon","getIcon","status","colorClasses","animationClasses","L","MapView","height","ref","navigate","useNavigate","sliderSettings","alertList","setAlertList","useState","notificationEvent","useNotification","getAlertListData","getAlertList","dayjs","res","err","useEffect","useImperativeHandle","groupedAlerts","acc","alert","alerts","priorityOrder","a","b","getAlertType","getHighestPriorityType","highest","type","jsx","jsxs","MapContainer","TileLayer","elderlyId","Marker","Popup","Slider","index","LuNavigation","MapView$1","forwardRef"],"mappings":"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"}