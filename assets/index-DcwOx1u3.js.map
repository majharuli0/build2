{"version":3,"file":"index-DcwOx1u3.js","sources":["../../src/Pages/UserProfileView/index.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useState } from \"react\";\r\nimport { useParams, useLocation, useNavigate } from \"react-router-dom\";\r\nimport ls from \"store2\";\r\nimport { getUserDetails, getUserToken } from \"@/api/Users\";\r\nimport { useCountStore } from \"@/store/index\";\r\nimport Loader from \"@/Components/Loader\";\r\nimport { getToken, setToken } from \"@/utils/auth\";\r\n\r\nexport default function UserProfileView() {\r\n  const params = useParams();\r\n  const location = useLocation();\r\n  const { role } = location.state || {};\r\n  const [loading, setLoading] = useState(true);\r\n  const { setStoreRole, setUser } = useCountStore();\r\n  const navigate = useNavigate();\r\n  const param = params.id.split(\"-\");\r\n\r\n  // Save the original/root user only once\r\n  const storeOriginalToken = () => {\r\n    if (!ls.get(\"rootToken\")) {\r\n      const currentToken = getToken();\r\n      const currentUser = ls.get(\"user\");\r\n      ls.set(\"rootToken\", currentToken);\r\n      ls.set(\"rootRole\", currentUser?.role);\r\n    }\r\n  };\r\n\r\n  // Switch to impersonated token\r\n  const switchToNewToken = (newToken) => {\r\n    setToken(newToken);\r\n  };\r\n\r\n  const getUserDetailAndSetRole = useCallback(() => {\r\n    getUserDetails({ id: param[0] })\r\n      .then((res) => {\r\n        if (res?.data?.role) {\r\n          getUserDetail(res.data.role);\r\n        }\r\n      })\r\n      .catch((err) => console.log(err));\r\n  }, [param]);\r\n\r\n  const getUserDetail = useCallback(\r\n    (apiRole) => {\r\n      if (param.length >= 2) {\r\n        // Case: impersonation\r\n        getUserToken({\r\n          id: param[0],\r\n          params: {\r\n            role: apiRole === \"nursing_home\" ? \"nurse\" : \"supports_agent\",\r\n          },\r\n        })\r\n          .then(async (res) => {\r\n            storeOriginalToken();\r\n            await setUpEverythingForViewProfile({\r\n              ...res.data,\r\n              sub_role: \"elderly\",\r\n            });\r\n            switchToNewToken(res.data.access_token);\r\n          })\r\n          .catch((err) => console.log(err));\r\n\r\n        // Fetch user details separately\r\n        getUserDetails({ id: param[0] })\r\n          .then((res) => {\r\n            storeOriginalToken();\r\n            if (res.data.role !== \"nursing_home\") {\r\n              setUpEverythingForViewProfile({\r\n                ...res.data,\r\n                sub_role: \"elderly\",\r\n              });\r\n            }\r\n          })\r\n          .catch((err) => console.log(err));\r\n\r\n        return;\r\n      }\r\n\r\n      // Case: normal user view\r\n      getUserDetails({ id: params.id })\r\n        .then((res) => setUpEverythingForViewProfile(res.data))\r\n        .catch((err) => console.log(err));\r\n\r\n      getUserToken({ id: params.id })\r\n        .then((res) => {\r\n          storeOriginalToken();\r\n          switchToNewToken(res.data.access_token);\r\n        })\r\n        .catch((err) => console.log(err));\r\n    },\r\n    [param, params.id]\r\n  );\r\n\r\n  const nvto = (active) => {\r\n    switch (active) {\r\n      case \"super_admin\":\r\n        navigate(\"/support-agent/dashboard/\");\r\n        break;\r\n      case \"supports_agent\":\r\n        navigate(\"/supporter/support-agent/dashboard\");\r\n        break;\r\n      case \"nurse\":\r\n        navigate(\"/supporter/nurse/dashboard\");\r\n        break;\r\n      case \"end_user\":\r\n        navigate(\"/supporter/end-user/dashboard\");\r\n        break;\r\n      case \"elderly\":\r\n        navigate(\r\n          `/supporter/elderlies/elderly-profile/${param[1]}?tab=overview`\r\n        );\r\n        break;\r\n      default:\r\n        navigate(\"/support-nurnt/dashboard\");\r\n    }\r\n  };\r\n\r\n  function setUpEverythingForViewProfile(data) {\r\n    // Target user (impersonated) always goes in here\r\n    ls.set(\"user\", data);\r\n    ls.set(\"mainRole\", data.role); // impersonated user’s main role\r\n    ls.set(\"role\", data.role); // active session role\r\n\r\n    // rootRole already stored separately, don’t overwrite it\r\n    setStoreRole({ role: data.role });\r\n    setUser({ role: data.role });\r\n\r\n    setTimeout(() => {\r\n      setLoading(false);\r\n      nvto(data?.sub_role || data?.role);\r\n    }, 1000);\r\n  }\r\n\r\n  useEffect(() => {\r\n    getUserDetailAndSetRole();\r\n  }, [getUserDetailAndSetRole]);\r\n\r\n  if (loading) return <Loader loaderTitle=\"Loading User Profile\" />;\r\n}\r\n"],"names":["UserProfileView","params","useParams","location","useLocation","role","loading","setLoading","useState","setStoreRole","setUser","useCountStore","navigate","useNavigate","param","storeOriginalToken","ls","currentToken","getToken","currentUser","switchToNewToken","newToken","setToken","getUserDetailAndSetRole","useCallback","getUserDetails","res","_a","getUserDetail","err","apiRole","getUserToken","setUpEverythingForViewProfile","nvto","active","data","useEffect","jsx","Loader"],"mappings":"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"}