{"version":3,"file":"LiveBreathRate-Caer6A9i.js","sources":["../../src/Pages/Elderlies/Components/TabContents/Health/Components/LiveBreathRate.jsx"],"sourcesContent":["import { useState, useEffect, useContext } from \"react\";\r\nimport LiveRateChart from \"@/Components/GraphAndChart/LiveRateChart\";\r\nimport { FaLungs } from \"react-icons/fa\";\r\nimport { CustomContext } from \"@/Context/UseCustomContext\";\r\nimport { decodeHeartBreath } from \"@/utils/helper\";\r\nexport default function BreathRate() {\r\n  const { elderlyDetails, sleepData } = useContext(CustomContext);\r\n  const deviceCode = elderlyDetails?.deviceId;\r\n\r\n  const [data, setData] = useState({\r\n    time: [],\r\n    heartRate: [],\r\n    breathRate: [],\r\n  });\r\n\r\n  const [liveRateData, setLiveRateData] = useState(null);\r\n  const [lastUpdate, setLastUpdate] = useState(Date.now());\r\n\r\n  // Decode action handler\r\n  const handleDecode = (base64Input) => {\r\n    const data = decodeHeartBreath(base64Input);\r\n    setLiveRateData(data);\r\n    setLastUpdate(Date.now());\r\n  };\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      const now = Date.now();\r\n      const isStale = now - lastUpdate > 5000; // Data is stale if older than 5 seconds\r\n\r\n      if (isStale) {\r\n        setLiveRateData(null);\r\n        setData({ time: [], heartRate: [], breathRate: [] }); // Reset to empty arrays, not just an empty array\r\n      } else if (liveRateData) {\r\n        const newTime = new Date().toLocaleTimeString();\r\n\r\n        // Update the data state with liveRateData values\r\n        setData((prevData) => ({\r\n          time: [...prevData.time, newTime].slice(-30),\r\n          heartRate: [...prevData.heartRate, liveRateData.heartRateValue].slice(\r\n            -30\r\n          ),\r\n          breathRate: [\r\n            ...prevData.breathRate,\r\n            liveRateData.breathingValue,\r\n          ].slice(-30),\r\n        }));\r\n      }\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [liveRateData, lastUpdate]);\r\n\r\n  useEffect(() => {\r\n    const ws = new WebSocket(\"wss://live.elderlycareplatform.com/ws/\");\r\n    ws.onopen = () => {\r\n      console.log(\"Connected to WebSocket server\");\r\n      // ws.send(JSON.stringify({ uid: deviceCode }));\r\n    };\r\n    ws.onmessage = (event) => {\r\n      const data = JSON.parse(event?.data);\r\n      const payload = JSON.parse(data?.message)?.payload;\r\n      if (payload?.deviceCode === deviceCode && payload?.heartbreath) {\r\n        handleDecode(payload.heartbreath);\r\n      }\r\n    };\r\n    ws.onerror = (error) => {\r\n      // console.error(\"WebSocket error:\", error);\r\n    };\r\n    ws.onclose = () => {\r\n      console.log(\"Disconnected from WebSocket server\");\r\n    };\r\n    return () => ws.close();\r\n  }, [deviceCode]);\r\n  return (\r\n    <div className=\"w-full bg-white rounded-2xl p-6 flex flex-col gap-6 h-auto\">\r\n      <div className=\"text-2xl font-bold text-primary\">\r\n        Current Breathing Pattern\r\n      </div>\r\n      <div id=\"LiveRate\" className=\"flex flex-col gap-1 pl-3 mb-2\">\r\n        <div\r\n          className={`text-4xl font-bold flex items-center gap-2`}\r\n          style={{\r\n            color: \"#FFA54D\",\r\n          }}\r\n        >\r\n          {liveRateData?.breathingValue ?? \"--\"}{\" \"}\r\n          <span className=\"text-secondary/40\">BPM</span>\r\n          <FaLungs color=\"#FFA54D\" size={24} />\r\n        </div>\r\n      </div>\r\n      <LiveRateChart data={data} color=\"#FFA54D\" type=\"breathRate\" />\r\n      <div id=\"footer\">\r\n        <div className=\"flex justify-evenly items-center\">\r\n          <div\r\n            id=\"avgRate\"\r\n            className=\"flex flex-col items-center justify-center gap-0\"\r\n          >\r\n            <div className=\"text-3xl text-primary font-bold\">\r\n              {sleepData?.breath_rate_vo?.avg ?? \"--\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500 font-semibold\">Avgerage</div>\r\n          </div>\r\n          <div\r\n            id=\"minRate\"\r\n            className=\"flex flex-col items-center justify-center gap-0\"\r\n          >\r\n            <div className=\"text-3xl text-primary font-bold\">\r\n              {\" \"}\r\n              {sleepData?.breath_rate_vo?.min ?? \"--\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500 font-semibold\">Minimum</div>\r\n          </div>\r\n          <div\r\n            id=\"maxRate\"\r\n            className=\"flex flex-col items-center justify-center gap-0\"\r\n          >\r\n            <div className=\"text-3xl text-primary font-bold\">\r\n              {\" \"}\r\n              {sleepData?.breath_rate_vo?.max ?? \"--\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500 font-semibold\">Maximum</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["BreathRate","elderlyDetails","sleepData","useContext","CustomContext","deviceCode","data","setData","useState","liveRateData","setLiveRateData","lastUpdate","setLastUpdate","handleDecode","base64Input","decodeHeartBreath","useEffect","interval","newTime","prevData","ws","event","payload","_a","error","jsxs","jsx","FaLungs","LiveRateChart","_b","_c"],"mappings":"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"}