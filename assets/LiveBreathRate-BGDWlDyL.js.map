{"version":3,"file":"LiveBreathRate-BGDWlDyL.js","sources":["../../src/Pages/Elderlies/Components/TabContents/Health/Components/LiveBreathRate.jsx"],"sourcesContent":["import { useState, useEffect, useContext } from \"react\";\r\nimport LiveRateChart from \"@/Components/GraphAndChart/LiveRateChart\";\r\nimport { FaLungs } from \"react-icons/fa\";\r\nimport { CustomContext } from \"@/Context/UseCustomContext\";\r\nimport { decodeHeartBreath } from \"@/utils/helper\";\r\nimport { Tooltip } from \"antd\";\r\nimport { IoMdInformationCircle } from \"react-icons/io\";\r\nexport default function BreathRate() {\r\n  const { elderlyDetails, sleepData } = useContext(CustomContext);\r\n  const deviceCode = elderlyDetails?.deviceId;\r\n\r\n  const [data, setData] = useState({\r\n    time: [],\r\n    heartRate: [],\r\n    breathRate: [],\r\n  });\r\n\r\n  const [liveRateData, setLiveRateData] = useState(null);\r\n  const [lastUpdate, setLastUpdate] = useState(Date.now());\r\n\r\n  // Decode action handler\r\n  const handleDecode = (base64Input) => {\r\n    const data = decodeHeartBreath(base64Input);\r\n    setLiveRateData(data);\r\n    setLastUpdate(Date.now());\r\n  };\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      const now = Date.now();\r\n      const isStale = now - lastUpdate > 5000; // Data is stale if older than 5 seconds\r\n\r\n      if (isStale) {\r\n        setLiveRateData(null);\r\n        setData({ time: [], heartRate: [], breathRate: [] }); // Reset to empty arrays, not just an empty array\r\n      } else if (liveRateData) {\r\n        const newTime = new Date().toLocaleTimeString();\r\n\r\n        // Update the data state with liveRateData values\r\n        setData((prevData) => ({\r\n          time: [...prevData.time, newTime].slice(-30),\r\n          heartRate: [...prevData.heartRate, liveRateData.heartRateValue].slice(\r\n            -30\r\n          ),\r\n          breathRate: [\r\n            ...prevData.breathRate,\r\n            liveRateData.breathingValue,\r\n          ].slice(-30),\r\n        }));\r\n      }\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [liveRateData, lastUpdate]);\r\n\r\n  useEffect(() => {\r\n    const ws = new WebSocket(\"wss://live.elderlycareplatform.com/ws/\");\r\n    ws.onopen = () => {\r\n      console.log(\"Connected to WebSocket server\");\r\n      // ws.send(JSON.stringify({ uid: deviceCode }));\r\n    };\r\n    ws.onmessage = (event) => {\r\n      const data = JSON.parse(event?.data);\r\n      const payload = JSON.parse(data?.message)?.payload;\r\n      if (payload?.deviceCode === deviceCode && payload?.heartbreath) {\r\n        handleDecode(payload.heartbreath);\r\n      }\r\n    };\r\n    ws.onerror = (error) => {\r\n      // console.error(\"WebSocket error:\", error);\r\n    };\r\n    ws.onclose = () => {\r\n      console.log(\"Disconnected from WebSocket server\");\r\n    };\r\n    return () => ws.close();\r\n  }, [deviceCode]);\r\n  return (\r\n    <div className=\"w-full bg-white rounded-2xl p-6 flex flex-col gap-6 h-auto\">\r\n      <div className=\"text-2xl font-bold text-primary flex items-center gap-2\">\r\n        Current Breathing Pattern\r\n        <Tooltip\r\n          title=\"This feature functions only if the user is in the monitoring bed.\"\r\n          className=\"cursor-pointer\"\r\n        >\r\n          <IoMdInformationCircle size=\"18px\" />\r\n        </Tooltip>\r\n      </div>\r\n      <div id=\"LiveRate\" className=\"flex flex-col gap-1 pl-3 mb-2\">\r\n        <div\r\n          className={`text-4xl font-bold flex items-center gap-2`}\r\n          style={{\r\n            color: \"#FFA54D\",\r\n          }}\r\n        >\r\n          {liveRateData?.breathingValue ?? \"--\"}{\" \"}\r\n          <span className=\"text-secondary/40\">BPM</span>\r\n          <FaLungs color=\"#FFA54D\" size={24} />\r\n        </div>\r\n      </div>\r\n      <LiveRateChart data={data} color=\"#FFA54D\" type=\"breathRate\" />\r\n      <div id=\"footer\">\r\n        <div className=\"flex justify-evenly items-center\">\r\n          <div\r\n            id=\"avgRate\"\r\n            className=\"flex flex-col items-center justify-center gap-0\"\r\n          >\r\n            <div className=\"text-3xl text-primary font-bold\">\r\n              {sleepData?.breath_rate_vo?.avg ?? \"--\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500 font-semibold\">Avgerage</div>\r\n          </div>\r\n          <div\r\n            id=\"minRate\"\r\n            className=\"flex flex-col items-center justify-center gap-0\"\r\n          >\r\n            <div className=\"text-3xl text-primary font-bold\">\r\n              {\" \"}\r\n              {sleepData?.breath_rate_vo?.min ?? \"--\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500 font-semibold\">Minimum</div>\r\n          </div>\r\n          <div\r\n            id=\"maxRate\"\r\n            className=\"flex flex-col items-center justify-center gap-0\"\r\n          >\r\n            <div className=\"text-3xl text-primary font-bold\">\r\n              {\" \"}\r\n              {sleepData?.breath_rate_vo?.max ?? \"--\"}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500 font-semibold\">Maximum</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["BreathRate","elderlyDetails","sleepData","useContext","CustomContext","deviceCode","data","setData","useState","liveRateData","setLiveRateData","lastUpdate","setLastUpdate","handleDecode","base64Input","decodeHeartBreath","useEffect","interval","newTime","prevData","ws","event","payload","_a","error","jsxs","jsx","Tooltip","IoMdInformationCircle","FaLungs","LiveRateChart","_b","_c"],"mappings":"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"}