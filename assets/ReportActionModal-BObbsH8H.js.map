{"version":3,"file":"ReportActionModal-BObbsH8H.js","sources":["../../src/Components/ReportActionModal/ReportActionModal.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport { Modal } from \"antd\";\nimport { MdReport } from \"react-icons/md\";\nimport CustomModal from \"@/Shared/modal/CustomModal\";\nimport { TbMessageReportFilled } from \"react-icons/tb\";\nimport { updateInstallationReport } from \"@/api/ordersManage\";\nimport ls from \"store2\";\nexport default function ReportActionModal({ report }) {\n  const [open, setOpen] = useState(false);\n  const mainRole = ls.get(\"mainRole\");\n  const [messages, setMessages] = useState(report?.messages || []);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const chatViewRef = useRef(null);\n  const handleSendMessage = async () => {\n    const newMessageObj = {\n      text: newMessage,\n      isInstaller: mainRole === \"installer\",\n      time: new Date().toISOString(),\n    };\n    if (newMessage.trim()) {\n      const res = await updateInstallationReport(report?._id, {\n        text: newMessage,\n        isInstaller: mainRole === \"installer\",\n        time: new Date().toISOString(),\n      });\n      if (res) {\n        setMessages([...messages, newMessageObj]);\n        setNewMessage(\"\");\n      }\n    }\n  };\n\n  const scrollToBottom = () => {\n    if (chatViewRef.current) {\n      chatViewRef.current.scrollTop = chatViewRef.current.scrollHeight;\n    }\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n  return (\n    <>\n      <TbMessageReportFilled\n        size={26}\n        onClick={() => setOpen(true)}\n        className=\"text-text-secondary cursor-pointer\"\n      />\n      <CustomModal\n        modalOPen={open}\n        setModalOpen={setOpen}\n        onCancel={() => setOpen(false)}\n        title=\"Installation Reports\"\n        isBottomButtomShow={false}\n      >\n        <div\n          id=\"ReportChatContainer\"\n          className=\"flex flex-col h-[500px] font-baloo\"\n        >\n          <div\n            id=\"chatViewArea\"\n            className=\"flex-1 overflow-y-auto p-4 space-y-4\"\n            ref={chatViewRef}\n          >\n            {messages.map((message, index) => (\n              <div\n                key={index}\n                className={`max-w-[70%] p-3 rounded-lg ${\n                  message.isInstaller\n                    ? \"ml-auto bg-[#6dc29a] text-white\"\n                    : \"mr-auto bg-[#80CAA7]/10 text-text-primary\"\n                }`}\n              >\n                <p className=\"text-xs font-bold mb-1\">\n                  {mainRole == \"installer\"\n                    ? message.isInstaller\n                      ? \"You\"\n                      : \"Manager\"\n                    : message.isInstaller\n                    ? \"Installer\"\n                    : \"You\"}\n                </p>\n                <p className=\"text-base mb-2\">{message.text}</p>\n                <p\n                  className={`text-sm  text-right ${\n                    message.isInstaller ? \"text-white\" : \"text-primary\"\n                  }`}\n                >\n                  {new Date(message.time).toDateString() ===\n                  new Date().toDateString()\n                    ? new Date(message.time).toLocaleTimeString([], {\n                        hour: \"2-digit\",\n                        minute: \"2-digit\",\n                      })\n                    : new Date(message.time).toLocaleString([], {\n                        hour: \"2-digit\",\n                        minute: \"2-digit\",\n                        year: \"numeric\",\n                        month: \"numeric\",\n                        day: \"numeric\",\n                      })}\n                </p>\n              </div>\n            ))}\n          </div>\n          <div id=\"chatInputArea\" className=\"flex p-4 pb-0 border-t\">\n            <input\n              type=\"text\"\n              value={newMessage}\n              onChange={(e) => setNewMessage(e.target.value)}\n              placeholder=\"Type your message...\"\n              className=\"py-[18px] px-4 text-text-primary placeholder:text-[#A3AED0] h-[50px]  rounded-[16px] w-full text-base outline-none   border-[1px] focus:border-primary rounded-r-none border-r-0\"\n              onKeyPress={(e) => e.key === \"Enter\" && handleSendMessage()}\n            />\n            <button\n              onClick={handleSendMessage}\n              className=\"bg-primary text-white px-8 py-2 rounded-r-[16px] hover:bg-primary focus:outline-none focus:ring-2 \"\n            >\n              Send\n            </button>\n          </div>\n        </div>\n      </CustomModal>\n    </>\n  );\n}\n"],"names":["ReportActionModal","report","open","setOpen","useState","mainRole","ls","messages","setMessages","newMessage","setNewMessage","chatViewRef","useRef","handleSendMessage","newMessageObj","updateInstallationReport","scrollToBottom","useEffect","jsxs","Fragment","jsx","TbMessageReportFilled","CustomModal","message","index"],"mappings":"uZAOwB,SAAAA,EAAkB,CAAE,OAAAC,GAAU,CACpD,KAAM,CAACC,EAAMC,CAAO,EAAIC,WAAS,EAAK,EAChCC,EAAWC,EAAG,IAAI,UAAU,EAC5B,CAACC,EAAUC,CAAW,EAAIJ,YAASH,GAAA,YAAAA,EAAQ,WAAY,CAAA,CAAE,EACzD,CAACQ,EAAYC,CAAa,EAAIN,WAAS,EAAE,EACzCO,EAAcC,SAAO,IAAI,EACzBC,EAAoB,SAAY,CACpC,MAAMC,EAAgB,CACpB,KAAML,EACN,YAAaJ,IAAa,YAC1B,KAAM,IAAI,KAAK,EAAE,YAAY,CAAA,EAE3BI,EAAW,QACD,MAAMM,EAAyBd,GAAA,YAAAA,EAAQ,IAAK,CACtD,KAAMQ,EACN,YAAaJ,IAAa,YAC1B,KAAM,IAAI,KAAK,EAAE,YAAY,CAAA,CAC9B,IAECG,EAAY,CAAC,GAAGD,EAAUO,CAAa,CAAC,EACxCJ,EAAc,EAAE,EAEpB,EAGIM,EAAiB,IAAM,CACvBL,EAAY,UACFA,EAAA,QAAQ,UAAYA,EAAY,QAAQ,aACtD,EAGFM,OAAAA,EAAAA,UAAU,IAAM,CACCD,GAAA,EACd,CAACT,CAAQ,CAAC,EAGTW,EAAA,KAAAC,WAAA,CAAA,SAAA,CAAAC,EAAA,IAACC,EAAA,CACC,KAAM,GACN,QAAS,IAAMlB,EAAQ,EAAI,EAC3B,UAAU,oCAAA,CACZ,EACAiB,EAAA,IAACE,EAAA,CACC,UAAWpB,EACX,aAAcC,EACd,SAAU,IAAMA,EAAQ,EAAK,EAC7B,MAAM,uBACN,mBAAoB,GAEpB,SAAAe,EAAA,KAAC,MAAA,CACC,GAAG,sBACH,UAAU,qCAEV,SAAA,CAAAE,EAAA,IAAC,MAAA,CACC,GAAG,eACH,UAAU,uCACV,IAAKT,EAEJ,SAASJ,EAAA,IAAI,CAACgB,EAASC,IACtBN,EAAA,KAAC,MAAA,CAEC,UAAW,8BACTK,EAAQ,YACJ,kCACA,2CACN,GAEA,SAAA,CAAAH,EAAA,IAAC,IAAE,CAAA,UAAU,yBACV,SAAAf,GAAY,YACTkB,EAAQ,YACN,MACA,UACFA,EAAQ,YACR,YACA,MACN,EACCH,EAAA,IAAA,IAAA,CAAE,UAAU,iBAAkB,WAAQ,KAAK,EAC5CA,EAAA,IAAC,IAAA,CACC,UAAW,uBACTG,EAAQ,YAAc,aAAe,cACvC,GAEC,aAAI,KAAKA,EAAQ,IAAI,EAAE,iBACpB,IAAA,OAAO,aAAa,EACpB,IAAI,KAAKA,EAAQ,IAAI,EAAE,mBAAmB,GAAI,CAC5C,KAAM,UACN,OAAQ,SAAA,CACT,EACD,IAAI,KAAKA,EAAQ,IAAI,EAAE,eAAe,GAAI,CACxC,KAAM,UACN,OAAQ,UACR,KAAM,UACN,MAAO,UACP,IAAK,SAAA,CACN,CAAA,CACP,CAAA,CAAA,EAnCKC,CAAA,CAqCR,CAAA,CACH,EACCN,EAAA,KAAA,MAAA,CAAI,GAAG,gBAAgB,UAAU,yBAChC,SAAA,CAAAE,EAAA,IAAC,QAAA,CACC,KAAK,OACL,MAAOX,EACP,SAAW,GAAMC,EAAc,EAAE,OAAO,KAAK,EAC7C,YAAY,uBACZ,UAAU,mLACV,WAAa,GAAM,EAAE,MAAQ,SAAWG,EAAkB,CAAA,CAC5D,EACAO,EAAA,IAAC,SAAA,CACC,QAASP,EACT,UAAU,qGACX,SAAA,MAAA,CAED,CAAA,EACF,CAAA,CAAA,CACF,CAAA,CACF,CACF,CAAA,CAAA,CAEJ"}