import{u as k,r as t,ba as A,b5 as M,j as s,b4 as w,b7 as $,b0 as W,a$ as B,b9 as H,bd as P,S as V,ab as Y,ac as F,e as C,aX as q,b1 as S,be as Q,b6 as z,bb as G}from"./index-VpceQPiu.js";import"./alertsOverview-A_qHpsU2.js";import{d as O}from"./debounce-BRAxygie.js";import{C as E}from"./Collapse-uL0ewUfl.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},i=new e.Error().stack;i&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[i]="3f906160-db46-4f97-acc5-6fa765948123",e._sentryDebugIdIdentifier="sentry-dbid-3f906160-db46-4f97-acc5-6fa765948123")}catch{}function U({data:e={}}){var p,v,m,h,j,a,b,o;const i=k();t.useState(null);const d=t.useRef(null);t.useRef(!1),t.useState(!1);const g=c=>{switch(c){case"Info":return"bg-blue-500";case"Critical":return"bg-red-500";case"Warning":return"bg-yellow-500";default:return"bg-blue-500"}};return t.useEffect(()=>{var u;const c=(u=e==null?void 0:e.rooms)==null?void 0:u.device_no;return c&&(d.current&&d.current!==c&&A({uid:d.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(f=>console.error(`Error unsubscribing: ${f}`)),M({uid:c,messageType:["1","2","3","4"],topics:{pub:[c]}}).then(()=>{}).catch(f=>console.error(`Error subscribing: ${f}`)),d.current=c),()=>{d.current&&A({uid:d.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(f=>console.error(`Error during cleanup unsubscribe: ${f}`))}},[e]),s.jsxs("div",{className:"w-full flex flex-col gap-4 p-4 pr-0 h-full pt-0",children:[s.jsxs("div",{id:"roomAlertHeader",className:`alert-header !h-[75px] flex justify-between items-center relative px-4 overflow-hidden rounded-lg ${g((p=w(e))==null?void 0:p.label)}`,children:[s.jsx("div",{className:"loader"}),s.jsxs("div",{className:"text-container flex flex-col gap-0 h-full justify-center text-white",children:[s.jsx("p",{className:"text-sm text-gray-100 m-0 font-medium",children:e.room_name}),s.jsx("h2",{className:"text-lg font-bold m-0 leading-none ",children:(v=w(e))==null?void 0:v.title})]}),s.jsx("span",{onClick:()=>{i(`/supporter/elderlies/elderly-profile/${e==null?void 0:e.elderly_id}`)},className:"text-sm text-gray-100 cursor-pointer p-3 py-2 bg-white/0 rounded-lg hover:bg-white/10 transition-all duration-300",children:"View Elderly"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex flex-col gap-0 border-b border-gray-200 pb-2 ",children:[s.jsx("h2",{className:"text-lg font-bold m-0 leading-none",children:e.elderly_name}),s.jsx("p",{className:"text-sm text-gray-500 m-0",children:e.address})]}),s.jsx("div",{})]}),s.jsxs("div",{id:"roomMapAndDetails",className:"flex gap-4 h-full overflow-hidden",children:[s.jsx($,{deviceId:(m=e==null?void 0:e.rooms)==null?void 0:m.device_no,children:s.jsxs("div",{className:"map-container w-2/3 border overflow-hidden h-full",children:[((h=e==null?void 0:e.rooms)==null?void 0:h.mount_type)===1&&((j=e==null?void 0:e.rooms)==null?void 0:j.is_device_bind)&&s.jsx(W,{roomInfo:e==null?void 0:e.rooms}),((a=e==null?void 0:e.rooms)==null?void 0:a.mount_type)===2&&((b=e==null?void 0:e.rooms)==null?void 0:b.is_device_bind)&&s.jsx(B,{roomInfo:e==null?void 0:e.rooms}),!((o=e==null?void 0:e.rooms)!=null&&o.is_device_bind)&&s.jsx("span",{className:"w-full h-full flex items-center justify-center",children:s.jsx("p",{children:" No Device Data Available"})})]})}),s.jsxs("div",{className:"details-container w-1/3 ",children:[s.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[s.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:H(e.created_at)}),s.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Time of Incident"})]}),s.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[s.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:s.jsx(P,{date:e.created_at})}),s.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Alert Life"})]})]})]})]})}const{Panel:X}=E;function se(){t.useContext(V);const{notificationEvent:e}=Y();t.useState("All");const[i,d]=t.useState([]),[g,p]=t.useState(null),[v,m]=t.useState(null),[h,j]=t.useState(null),[a,b]=t.useState(!1),[o,c]=t.useState(1),[u,f]=t.useState(!0),y=t.useRef(null),_=t.useCallback(()=>{!u||a||(b(!0),F({to_date:"2024-11-30",from_date:C().format("YYYY-MM-DD"),is_resolved:!1,limit:20,show_device_area:1,show_device_boundaries:1,page:o,...h}).then(l=>{d(r=>[...r,...l.data]),o>=l.totalPages&&f(!1),b(!1)}).catch(l=>{console.error(l),b(!1)}))},[h,o,u,a]);t.useEffect(()=>{_()},[o,h]),t.useEffect(()=>{if(i.length>0&&!g){const l=i[0];p(l._id),m(l)}},[i,g]);const I=l=>{p(l);const r=i.find(n=>n._id===l);m(r)},N=t.useCallback(O(()=>{if(!y.current||a||!u)return;const{scrollTop:l,scrollHeight:r,clientHeight:n}=y.current;l+n>=r-50&&c(x=>x+1)},200),[a,u]),T=l=>{j(G(l)),c(1),d([]),f(!0)};t.useEffect(()=>{e&&_()},[e]),t.useEffect(()=>{const l=y.current;return l&&l.addEventListener("scroll",N),()=>{l&&l.removeEventListener("scroll",N)}},[N]);const L=t.useMemo(()=>i.reduce((l,r)=>{const n=r.room_name;return l[n]||(l[n]=[]),l[n].push(r),l},{}),[i]),R=l=>{switch(l){case"Critical":return"red";case"Warning":return"orange";case"Info":return"blue";default:return"gray"}};return s.jsxs("div",{className:"w-full flex justify-center items-center h-[495px] overflow-hidden",children:[s.jsxs("div",{className:"w-[30%] flex flex-col gap-4 h-full",children:[s.jsx(q,{style:{width:"100%"},block:!0,options:J,onChange:l=>T(l)}),s.jsxs("div",{ref:y,className:"w-full overflow-auto",style:{height:"440px"},children:[i.length===0&&!a&&s.jsx(S,{description:"No active alerts available"}),i.length>0&&s.jsx(E,{children:Object.entries(L).map(([l,r])=>([...new Set(r.map(n=>{var x;return(x=w(n))==null?void 0:x.label}))],s.jsx(X,{header:s.jsx("div",{className:"flex justify-between items-center",children:s.jsx("span",{className:"text-black font-semibold",children:l})}),children:r&&r.map(n=>{var x;return s.jsxs("div",{onClick:()=>I(n._id),className:`flex justify-between items-center p-2 cursor-pointer rounded-md px-4 ${g===n._id?"bg-gray-100":""}`,children:[s.jsx("span",{className:"text-[14px] font-semibold",children:C(n.created_at).format("hh:mm:ss a")}),s.jsx(Q,{color:R((x=w(n))==null?void 0:x.label),size:"large"})]},n._id)})},l)))}),a&&s.jsx("div",{className:"w-full flex justify-center py-4",children:s.jsx(z,{})}),!u&&i.length>0&&s.jsx("div",{className:"w-full text-center py-4 text-gray-500",children:"No more alerts to load"})]})]}),s.jsx("div",{className:"w-[70%] h-full",children:v?s.jsx(U,{data:v}):s.jsx(S,{description:"Select an alert to view details"})})]})}const J=[{label:"All",value:"All"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Info",value:"Info"}];export{se as R};
//# sourceMappingURL=index-W3323wxu.js.map
