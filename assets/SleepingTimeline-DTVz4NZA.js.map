{"version":3,"file":"SleepingTimeline-DTVz4NZA.js","sources":["../../src/Pages/Elderlies/Components/TabContents/Sleep/Components/SleepingTimeline.jsx"],"sourcesContent":["import { useContext, useEffect, useState } from \"react\";\nimport TimelineGraph from \"@/Components/GraphAndChart/TimelineGraph\";\nimport { Button } from \"antd\";\nimport { FileOutlined } from \"@ant-design/icons\";\nimport SummaryModal from \"@/Components/SummaryModal/SummaryModal\";\nimport { FaTimeline } from \"react-icons/fa6\";\nimport { getSleepSummary } from \"@/api/deviceReports\";\nimport { CustomContext } from \"@/Context/UseCustomContext\";\nimport Template from \"@/Components/GraphAndChartTemp/Template\";\nimport { transformTime } from \"@/utils/helper\";\nimport { SidebarContext } from \"@/Context/CustomContext\";\nimport SkeletonSleepingTimeline from \"@/components/Skeleton/SkeletonSleepingTimeline\";\nimport { formatTimeWithSuffix } from \"@/utils/helper\";\n\nconst TimelineItem = ({ time, ItemName, color }) => {\n  return (\n    <div\n      className={`flex p-[4px] pr-4 items-center gap-2 rounded-xl`}\n      style={{ backgroundColor: color || \"#FF725E\" }}\n    >\n      <span className=\"text-[17px] p-2 py-1 font-bold bg-white rounded-[9px] text-primary\">\n        {time}\n      </span>\n      <span className=\"text-[15px] font-medium text-white leading-[1.2]\">\n        {ItemName}\n      </span>\n    </div>\n  );\n};\n\nexport default function SleepingTimeline() {\n  const { sleepData, elderlyDetails, sleepDataLoading } =\n    useContext(CustomContext);\n  const { sleepEventsType, sleepEventsColor } = useContext(SidebarContext);\n  const [events, setEvents] = useState([]);\n\n  const summaryProps = {\n    title: \"Sleep Timeline Summary\",\n    pickerTypes: [\"day\", \"range\"],\n    chartType: \"multibar\",\n    dataType: \"duration\",\n    color: \"#FF725E\",\n    icon: <FaTimeline />,\n    apisProps: {\n      endpoint: getSleepSummary,\n      query: {\n        uids: elderlyDetails?.deviceId,\n      },\n    },\n  };\n  function minutesToHoursAndMinutes(minutes) {\n    if (minutes == 0) return \"0m\";\n    if (minutes < 60) return `${minutes}m`;\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    return `${hours}hr ${mins}m`;\n  }\n  // useEffect(() => {\n  //   if (!sleepData) return;\n  //   const aggregatedEvents = sleepData?.statistical_data?.reduce(\n  //     (acc, data) => {\n  //       if (data.status === \"3\") return acc;\n  //       const startTime = new Date(data.start_time);\n  //       const endTime = new Date(data.end_time);\n  //       const durationInMinutes = (endTime - startTime) / (1000 * 60);\n  //       const statusName = sleepEventsType[data.status];\n  //       if (!acc[statusName]) {\n  //         acc[statusName] = {\n  //           duration: 0,\n  //           color: sleepEventsColor[statusName],\n  //         };\n  //       }\n  //       acc[statusName].duration += durationInMinutes;\n  //       return acc;\n  //     },\n  //     {}\n  //   );\n\n  //   const events = Object.entries(aggregatedEvents || {}).map(\n  //     ([name, { duration, color }]) => {\n  //       const hours = Math.floor(duration / 60);\n  //       const minutes = Math.floor(duration % 60);\n  //       return {\n  //         name,\n  //         duration: `${hours}hr ${minutes}m`,\n  //         color,\n  //       };\n  //     }\n  //   );\n\n  //   setEvents([...events]);\n  // }, [sleepData, sleepEventsType, sleepEventsColor]);\n  function transformSleepData(originalData, sleepEventsType, sleepEventsColor) {\n    const transformedData = {};\n\n    originalData.forEach((item) => {\n      const status = item.status;\n      const typeName = sleepEventsType[status];\n\n      transformedData[status] = {\n        name: typeName,\n        value: Number(item.value) || 0,\n        color: sleepEventsColor[typeName] || \"#CCCCCC\",\n      };\n    });\n\n    return transformedData;\n  }\n  useEffect(() => {\n    if (sleepData?.sleep_index_common_list) {\n      const transformedData = transformSleepData(\n        sleepData.sleep_index_common_list,\n        sleepEventsType,\n        sleepEventsColor\n      );\n      setEvents(transformedData);\n    }\n  }, [sleepData, sleepEventsType, sleepEventsColor]);\n  return (\n    <Template\n      title=\"Sleep Timeline\"\n      color=\"#FF725E\"\n      icon={<FaTimeline />}\n      isDataAnalysis={false}\n      headerClassName=\"!text-2xl\"\n      summaryProps={summaryProps}\n    >\n      {sleepDataLoading ? (\n        <SkeletonSleepingTimeline />\n      ) : (\n        <>\n          <TimelineGraph\n            statisticalData={sleepData?.statistical_data}\n            enterBedTime={formatTimeWithSuffix(sleepData?.get_bed_idx)}\n            getupAfterTime={formatTimeWithSuffix(sleepData?.leave_bed_idx)}\n            noDataText=\"No Data Detected for Today\"\n          />\n          <div className=\"flex flex-wrap gap-4 items-center justify-center\">\n            {sleepData && sleepData?.leave_bed_idx && (\n              <TimelineItem\n                time={formatTimeWithSuffix(sleepData?.sleep_st_idx)}\n                ItemName={\"Fell Asleep\"}\n                color={\"#AAA492\"}\n              />\n            )}\n\n            {/* {events.map((item, i) => (\n              <TimelineItem\n                key={i}\n                time={item.duration}\n                ItemName={item.name}\n                color={item.color}\n              />\n            ))} */}\n\n            {events && events[1] && (\n              <TimelineItem\n                time={minutesToHoursAndMinutes(events[1]?.value)}\n                ItemName={\"Light Sleep\"}\n                color={events[1]?.color}\n              />\n            )}\n            {events && events[0] && (\n              <TimelineItem\n                time={minutesToHoursAndMinutes(events[0]?.value)}\n                ItemName={\"Deep Sleep\"}\n                color={events[0]?.color}\n              />\n            )}\n            {events && events[7] && (\n              <TimelineItem\n                time={minutesToHoursAndMinutes(events[7]?.value)}\n                ItemName={\"REM\"}\n                color={events[7]?.color}\n              />\n            )}\n            {events && events[2] && (\n              <TimelineItem\n                time={minutesToHoursAndMinutes(events[2]?.value)}\n                ItemName={\"Awake After Sleep\"}\n                color={events[2]?.color}\n              />\n            )}\n\n            {sleepData && sleepData?.leave_bed_count && (\n              <TimelineItem\n                time={sleepData?.leave_bed_count + \"x\"}\n                ItemName={\"Bed Exit After Sleep\"}\n                color={\"#FF725E\"}\n              />\n            )}\n            {sleepData && sleepData?.sleep_ed_idx && (\n              <TimelineItem\n                time={formatTimeWithSuffix(sleepData?.sleep_ed_idx)}\n                ItemName={\"Wake Up\"}\n                color={\"#AAA492\"}\n              />\n            )}\n            {/* {sleepData && sleepData?.leave_bed_count && (\n              <TimelineItem\n                time={sleepData?.leave_bed_count + \"x\"}\n                ItemName={\"Leave bed after sleep\"}\n                color={\"#FF725E\"}\n              />\n            )} */}\n          </div>\n        </>\n      )}\n    </Template>\n  );\n}\n"],"names":["TimelineItem","time","ItemName","color","jsxs","jsx","SleepingTimeline","sleepData","elderlyDetails","sleepDataLoading","useContext","CustomContext","sleepEventsType","sleepEventsColor","SidebarContext","events","setEvents","useState","summaryProps","FaTimeline","getSleepSummary","minutesToHoursAndMinutes","minutes","hours","mins","transformSleepData","originalData","transformedData","item","status","typeName","useEffect","Template","SkeletonSleepingTimeline","Fragment","TimelineGraph","formatTimeWithSuffix","_a","_b","_c","_d","_e","_f","_g","_h"],"mappings":"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"}