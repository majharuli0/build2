{"version":3,"file":"LiveBreathRate-yhZ6VLoS.js","sources":["../../src/Pages/Elderlies/Components/TabContents/Health/Components/LiveBreathRate.jsx"],"sourcesContent":["import { useState, useEffect, useContext } from \"react\";\nimport LiveRateChart from \"@/Components/GraphAndChart/LiveRateChart\";\nimport { FaLungs } from \"react-icons/fa\";\nimport { CustomContext } from \"@/Context/UseCustomContext\";\nimport { decodeHeartBreath } from \"@/utils/helper\";\nexport default function BreathRate() {\n  const { elderlyDetails, sleepData } = useContext(CustomContext);\n  const deviceCode = elderlyDetails?.deviceId;\n\n  const [data, setData] = useState({\n    time: [],\n    heartRate: [],\n    breathRate: [],\n  });\n\n  const [liveRateData, setLiveRateData] = useState(null);\n  const [lastUpdate, setLastUpdate] = useState(Date.now());\n\n  // Decode action handler\n  const handleDecode = (base64Input) => {\n    const data = decodeHeartBreath(base64Input);\n    setLiveRateData(data);\n    setLastUpdate(Date.now());\n  };\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const now = Date.now();\n      const isStale = now - lastUpdate > 5000; // Data is stale if older than 5 seconds\n\n      if (isStale) {\n        setLiveRateData(null);\n        setData({ time: [], heartRate: [], breathRate: [] }); // Reset to empty arrays, not just an empty array\n      } else if (liveRateData) {\n        const newTime = new Date().toLocaleTimeString();\n\n        // Update the data state with liveRateData values\n        setData((prevData) => ({\n          time: [...prevData.time, newTime].slice(-30),\n          heartRate: [...prevData.heartRate, liveRateData.heartRateValue].slice(\n            -30\n          ),\n          breathRate: [\n            ...prevData.breathRate,\n            liveRateData.breathingValue,\n          ].slice(-30),\n        }));\n      }\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [liveRateData, lastUpdate]);\n\n  useEffect(() => {\n    const ws = new WebSocket(\"wss://live.elderlycareplatform.com/ws/\");\n    ws.onopen = () => {\n      console.log(\"Connected to WebSocket server\");\n      // ws.send(JSON.stringify({ uid: deviceCode }));\n    };\n    ws.onmessage = (event) => {\n      const data = JSON.parse(event?.data);\n      const payload = JSON.parse(data?.message)?.payload;\n      if (payload?.deviceCode === deviceCode && payload?.heartbreath) {\n        handleDecode(payload.heartbreath);\n      }\n    };\n    ws.onerror = (error) => {\n      // console.error(\"WebSocket error:\", error);\n    };\n    ws.onclose = () => {\n      console.log(\"Disconnected from WebSocket server\");\n    };\n    return () => ws.close();\n  }, [deviceCode]);\n  return (\n    <div className=\"w-full bg-white rounded-2xl p-6 flex flex-col gap-6 h-auto\">\n      <div className=\"text-2xl font-bold text-primary\">\n        Current Breathing Pattern\n      </div>\n      <div id=\"LiveRate\" className=\"flex flex-col gap-1 pl-3 mb-2\">\n        <div\n          className={`text-4xl font-bold flex items-center gap-2`}\n          style={{\n            color: \"#FFA54D\",\n          }}\n        >\n          {liveRateData?.breathingValue ?? \"--\"}{\" \"}\n          <span className=\"text-secondary/40\">BPM</span>\n          <FaLungs color=\"#FFA54D\" size={24} />\n        </div>\n      </div>\n      <LiveRateChart data={data} color=\"#FFA54D\" type=\"breathRate\" />\n      <div id=\"footer\">\n        <div className=\"flex justify-evenly items-center\">\n          <div\n            id=\"avgRate\"\n            className=\"flex flex-col items-center justify-center gap-0\"\n          >\n            <div className=\"text-3xl text-primary font-bold\">\n              {sleepData?.breath_rate_vo?.avg ?? \"--\"}\n            </div>\n            <div className=\"text-sm text-gray-500 font-semibold\">Avgerage</div>\n          </div>\n          <div\n            id=\"minRate\"\n            className=\"flex flex-col items-center justify-center gap-0\"\n          >\n            <div className=\"text-3xl text-primary font-bold\">\n              {\" \"}\n              {sleepData?.breath_rate_vo?.min ?? \"--\"}\n            </div>\n            <div className=\"text-sm text-gray-500 font-semibold\">Minimum</div>\n          </div>\n          <div\n            id=\"maxRate\"\n            className=\"flex flex-col items-center justify-center gap-0\"\n          >\n            <div className=\"text-3xl text-primary font-bold\">\n              {\" \"}\n              {sleepData?.breath_rate_vo?.max ?? \"--\"}\n            </div>\n            <div className=\"text-sm text-gray-500 font-semibold\">Maximum</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["BreathRate","elderlyDetails","sleepData","useContext","CustomContext","deviceCode","data","setData","useState","liveRateData","setLiveRateData","lastUpdate","setLastUpdate","handleDecode","base64Input","decodeHeartBreath","useEffect","interval","newTime","prevData","ws","event","payload","_a","error","jsxs","jsx","FaLungs","LiveRateChart","_b","_c"],"mappings":"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"}