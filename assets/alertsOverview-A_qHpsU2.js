import{r as c,S as Y,u as T,ab as S,ac as W,e as f,j as e,aZ as L,b4 as w,bf as _,b9 as I,bd as E,bg as F,ah as R,bb as O,b1 as B,E as P,bh as $,aH as z,D as H,bi as G,C as U}from"./index-VpceQPiu.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},h=new s.Error().stack;h&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[h]="4b0a8c01-3664-479d-9036-e19c78fc4ac7",s._sentryDebugIdIdentifier="sentry-dbid-4b0a8c01-3664-479d-9036-e19c78fc4ac7")}catch{}function Z({refreshAlertList:s,isElderlyVisible:h=!1,isAlarmViewBtn:i=!1}){c.useContext(Y);const[m,p]=c.useState(!1),[o,u]=c.useState(null),[a,t]=c.useState([]),n=["Critical"],d=T(),{notificationEvent:l}=S(),g=c.useRef(0),x=c.useCallback(async()=>{let r=[],b=30;for(const y of n){if(b<=0)break;const M=O(y);if(M)try{const v=(await W({to_date:"2024-11-30",from_date:f().format("YYYY-MM-DD"),is_resolved:!1,limit:b,...M})).data||[];if(r=[...r,...v],b-=v.length,b<=0)break}catch(A){console.error(`Error fetching ${y} alerts:`,A)}}r.length>g.current&&s(),g.current=r.length,t(r)},[]);c.useEffect(()=>{x()},[x]);const C={dots:a.length>=2,infinite:a.length>2,speed:500,slidesToShow:a.length===1?1:2,slidesToScroll:1,draggable:!0,arrows:!1,appendDots:r=>e.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"2px"},children:e.jsx("ul",{id:"dots",style:{margin:"0px"},children:r})}),responsive:[{breakpoint:1200,settings:{slidesToShow:(a.length===1,1),slidesToScroll:1}},{breakpoint:800,settings:{slidesToShow:1,slidesToScroll:1}}]},N=r=>{window.scrollTo(0,0),d(`/supporter/elderlies/elderly-profile/${r.elderly_id}?tab=overview`)};return c.useEffect(()=>{l&&x()},[l]),e.jsxs(e.Fragment,{children:[a.length>0&&e.jsx("div",{id:"ActiveAlertsCards",className:"w-full mb-2 transition-all duration-300",children:e.jsx(L,{...C,className:"w-full transition-all duration-300",children:a.map((r,b)=>{var y,M,A,v,D,j;return e.jsx("div",{className:"px-2 overflow-hidden transition-all duration-300 relative w-full",children:e.jsxs("div",{id:"alertItem",className:`rounded-2xl overflow-hidden w-full ${((y=w(r))==null?void 0:y.label)==="Critical"?"bg-red-500":((M=w(r))==null?void 0:M.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} p-4 w-full flex justify-between items-center`,children:[e.jsx("div",{id:"leftSide",className:"z-50",children:e.jsx("div",{id:"alertItemHeader",children:e.jsxs("div",{id:"alertItemTitleAndDescription",className:"flex flex-col gap-6",children:[e.jsxs("div",{id:"time",className:"flex gap-2",children:[h&&e.jsxs("span",{onClick:()=>N(r),className:"bg-white font-semibold p-1 px-2 pl-1 rounded-full text-text-primary flex items-center gap-2 cursor-pointer hover:opacity-90",children:[e.jsx(_,{size:22,style:{opacity:"0.8"}}),r==null?void 0:r.elderly_name]}),e.jsxs("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary flex items-center gap-2",children:[e.jsx("div",{id:"dot",className:`w-2 h-2 ${((A=w(r))==null?void 0:A.label)==="Critical"?"bg-red-500":((v=w(r))==null?void 0:v.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} rounded-full animate-ping`}),I(r.created_at)]}),e.jsx("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary",children:e.jsx(E,{date:r.created_at})})]}),e.jsxs("div",{id:"alertItemTitleAndDescription",children:[e.jsx("h1",{className:"text-xl font-bold text-white m-0",children:(D=w(r))==null?void 0:D.title}),e.jsx("p",{className:"text-white text-base m-0 leading-none",children:(j=w(r))==null?void 0:j.message})]})]})})}),i?e.jsx("div",{id:"btn",className:"z-50 w-fit",children:e.jsx("span",{onClick:()=>{u(r),d("/support-nurnt/dashboard/alarm-detail",{state:{alertData:r,id:r==null?void 0:r.elderly_id}})},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"View Alert"})}):e.jsx("div",{id:"rightSide",className:"z-50 w-fit",children:e.jsx("span",{onClick:()=>{u(r),p(!0)},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"Mark as Complete"})}),e.jsx("img",{src:F,alt:"",className:"absolute top-0 right-0"})]})},b)})})}),e.jsx(R,{openAlertCloseModal:m,setOpenAlertCloseModal:p,selectedAlert:o,getAlertListDatas:()=>{x(),s()}})]})}function J({data:s=[],fromDate:h,toDate:i}){const o=((a,t)=>{const n=[];let d=f(a);for(;d.isBefore(t)||d.isSame(t,"day");)n.push(d.format("YYYY-MM-DD")),d=d.add(1,"day");return n})(h,i).map(a=>{const t=s.filter(l=>l.date===a&&l.alarm_group==="Critical").reduce((l,g)=>l+g.count,0),n=s.filter(l=>l.date===a&&l.alarm_group==="Warning").reduce((l,g)=>l+g.count,0),d=s.filter(l=>l.date===a&&l.alarm_group==="Info").reduce((l,g)=>l+g.count,0);return{day:f(a).format("ddd"),critical:t,warning:n,problem:d}}),u={tooltip:{trigger:"axis"},grid:{left:"0%",right:"0%",bottom:"20%",top:"10%",containLabel:!0},legend:{show:!0,orient:"horizontal",bottom:"10%"},xAxis:{type:"category",data:o.map(a=>a.day)},yAxis:{type:"value"},series:[{name:"Critical",type:"line",data:o.map(a=>a.critical),itemStyle:{color:"#FF0000"},smooth:!0},{name:"Warning",type:"line",data:o.map(a=>a.warning),itemStyle:{color:"#FFA500"},smooth:!0},{name:"Problem",type:"line",data:o.map(a=>a.problem),itemStyle:{color:"#800080"},smooth:!0}]};return s.length?e.jsx(P,{option:u,style:{width:"100% !important",height:"100%"}}):e.jsx("div",{className:"h-full flex items-center w-full justify-center",children:e.jsx(B,{description:"No data available to show"})})}f.extend($);f.extend(z);const V=({placeholder:s,style:h,handleChange:i,value:m})=>{const[p,o]=c.useState("This Week"),u=t=>{const n=f(t).startOf("week").format("YYYY-MM-DD"),d=f(t).endOf("week").format("YYYY-MM-DD");return{week:f(t).week(),start:n,end:d}},a=t=>`Week ${u(t).week}`;return c.useEffect(()=>{if(m){const t=f().week(),n=f(m.start).week();n===t-1?o("Last Week"):o(`Week ${n}`)}else o("This Week")},[m]),e.jsx(H,{style:h,placeholder:p,size:"large",format:a,picker:"week",onChange:t=>{if(t){const n=u(t);i(n)}else i(""),o("This Week")}})},k=s=>{const h=["Critical","Info","Warning"],i=["Living Room","Kitchen","Bedroom","Bathroom"],m=["John Doe","Jane Doe","Alice Smith","Bob Johnson","Emma Brown","Michael Wilson","Sarah Davis","David Miller","Lisa Garcia","James Rodriguez"],p=["Fall Detected","Fire Detected","Inactivity Alert","Medication Reminder","Unusual Behavior","High Temperature","Low Temperature","Water Leak","Door Left Open","Window Broken"],o=["Medication Taken","Medication Not Taken","Medication Reminder"],u=["Wheelchair","Crutches","Cane","None"],a=["Yes","No"],t=["Yes","No"],n=["Yes","No"],d=["1","4","2","No"],l=["True","False"];return Array.from({length:s},(g,x)=>({_id:x+1,alertType:h[Math.floor(Math.random()*h.length)],elderlyName:m[Math.floor(Math.random()*m.length)],alertName:p[Math.floor(Math.random()*p.length)],roomId:String(x+1),roomName:i[Math.floor(Math.random()*i.length)],alertLifetime:`${Math.floor(Math.random()*10)}m ${Math.floor(Math.random()*60)}s`,time:new Date().toLocaleString(),alertDescription:`${p[Math.floor(Math.random()*p.length)]} in the ${i[Math.floor(Math.random()*i.length)]}`,status:"Active",isAlert:l[Math.floor(Math.random()*l.length)],address:"123 Main St, Anytown, USA",coordinates:{latitude:37.7749+(Math.random()-.5)*.01,longitude:-122.4194+(Math.random()-.5)*.01},closedAt:new Date().toLocaleString(),closedBy:m[Math.floor(Math.random()*m.length)],eventName:o[Math.floor(Math.random()*o.length)],disabilityType:u[Math.floor(Math.random()*u.length)],additionalInfo:"This is additional info for event",hospital:{name:"Hospital For Special Surgery",phone:"1234567890",latitude:-33.8743612,longitude:151.2261153},allergies:a[Math.floor(Math.random()*a.length)],diseases:t[Math.floor(Math.random()*t.length)],medications:n[Math.floor(Math.random()*n.length)],activeAlert:d[Math.floor(Math.random()*d.length)],alertComments:"This is alert comments",alertLifespan:[{dateTime:"24-01-2024 10:00 AM",description:"At 10:00 AM, the alert was created"},{dateTime:"24-01-2024 10:30 AM",description:"Agent (petar) clicked on the incident in 10:30 (30mins later)"},{dateTime:"24-01-2024 10:32 AM",description:"Agent (petar) clicked on “Call Elderly” in 10:32 (2mins later)"},{dateTime:"24-01-2024 10:34 AM",description:"Agent (petar) clicked on “Call 911” in 10:34 (2mins later)"},{dateTime:"24-01-2024 10:36 AM",description:"Agent (petar) clicked on “Close Alert” in 10:36 (2mins later)"}]}))};k(14);k(20);k(20);k(20);k(20);function q(){const[s,h]=c.useState(f().subtract(6,"days").format("YYYY-MM-DD")),[i,m]=c.useState(f().format("YYYY-MM-DD")),[p,o]=c.useState([]),u=c.useCallback(()=>{G({from_date:i,to_date:s}).then(t=>{o(t==null?void 0:t.data)}).catch(t=>{console.log(t)})},[i]);c.useEffect(()=>{u()},[u]);function a(t){t?(h(t.start),m(t.end)):(h(f().subtract(6,"days").format("YYYY-MM-DD")),m(f().format("YYYY-MM-DD")))}return e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{id:"ChartHeader",className:"w-full flex justify-between",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"Overview"}),e.jsx("div",{id:"chartController",className:"flex gap-4",children:e.jsx(U,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:e.jsx(V,{style:{height:"fit-content"},handleChange:t=>a(t)})})})]}),e.jsx("div",{className:"w-full h-full",children:e.jsx(J,{data:p,fromDate:s,toDate:i})})]})}export{Z as A,q as a};
//# sourceMappingURL=alertsOverview-A_qHpsU2.js.map
