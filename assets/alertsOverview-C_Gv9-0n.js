import{r as l,S as E,u as I,ai as W,aj as R,e as b,j as e,b3 as O,bP as j,bQ as H,bR as F,bS as $,bT as z,ao as V,bf as P,bU as L,bK as J,bL as U,bJ as D,bI as G,b1 as Q,J as Y,bV as q,H as K,E as X,bW as Z,aN as ee,D as te,bX as se,C as le}from"./index-BBnnZ3n6.js";import{d as ne}from"./debounce-vv4YQH-A.js";import{C as B}from"./Collapse-BahkQ90_.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},o=new t.Error().stack;o&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[o]="f89dd2c9-1a19-4164-bae6-ccdfd5e0db57",t._sentryDebugIdIdentifier="sentry-dbid-f89dd2c9-1a19-4164-bae6-ccdfd5e0db57")}catch{}function fe({refreshAlertList:t,isElderlyVisible:o=!1,isAlarmViewBtn:c=!1}){l.useContext(E);const[f,g]=l.useState(!1),[u,p]=l.useState(null),[n,s]=l.useState([]),d=["Critical"],h=I(),{notificationEvent:i}=W(),m=l.useRef(0),x=l.useCallback(async()=>{let a=[],A=30;for(const M of d){if(A<=0)break;const N=P(M);if(N)try{const k=(await R({to_date:"2024-11-30",from_date:b().format("YYYY-MM-DD"),is_resolved:!1,limit:A,...N})).data||[];if(a=[...a,...k],A-=k.length,A<=0)break}catch(C){console.error(`Error fetching ${M} alerts:`,C)}}a.length>m.current&&t(),m.current=a.length,s(a)},[]);l.useEffect(()=>{x()},[x]);const w={dots:n.length>=2,infinite:n.length>2,speed:500,slidesToShow:n.length===1?1:2,slidesToScroll:1,draggable:!0,arrows:!1,appendDots:a=>e.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"2px"},children:e.jsx("ul",{id:"dots",style:{margin:"0px"},children:a})}),responsive:[{breakpoint:1200,settings:{slidesToShow:(n.length===1,1),slidesToScroll:1}},{breakpoint:800,settings:{slidesToShow:1,slidesToScroll:1}}]},_=a=>{window.scrollTo(0,0),h(`/supporter/elderlies/elderly-profile/${a.elderly_id}?tab=overview`)};return l.useEffect(()=>{i&&x()},[i]),e.jsxs(e.Fragment,{children:[n.length>0&&e.jsx("div",{id:"ActiveAlertsCards",className:"w-full mb-2 transition-all duration-300",children:e.jsx(O,{...w,className:"w-full transition-all duration-300",children:n.map((a,A)=>{var M,N,C,k,r,v;return e.jsx("div",{className:"px-2 overflow-hidden transition-all duration-300 relative w-full",children:e.jsxs("div",{id:"alertItem",className:`rounded-2xl overflow-hidden w-full ${((M=j(a))==null?void 0:M.label)==="Critical"?"bg-red-500":((N=j(a))==null?void 0:N.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} p-4 w-full flex justify-between items-center`,children:[e.jsx("div",{id:"leftSide",className:"z-50",children:e.jsx("div",{id:"alertItemHeader",children:e.jsxs("div",{id:"alertItemTitleAndDescription",className:"flex flex-col gap-6",children:[e.jsxs("div",{id:"time",className:"flex gap-2",children:[o&&e.jsxs("span",{onClick:()=>_(a),className:"bg-white font-semibold p-1 px-2 pl-1 rounded-full text-text-primary flex items-center gap-2 cursor-pointer hover:opacity-90",children:[e.jsx(H,{size:22,style:{opacity:"0.8"}}),a==null?void 0:a.elderly_name]}),e.jsxs("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary flex items-center gap-2",children:[e.jsx("div",{id:"dot",className:`w-2 h-2 ${((C=j(a))==null?void 0:C.label)==="Critical"?"bg-red-500":((k=j(a))==null?void 0:k.label)==="Warning"?"bg-yellow-500":"bg-blue-500"} rounded-full animate-ping`}),F(a.created_at)]}),e.jsx("span",{className:"bg-white font-semibold p-1 px-2 rounded-full text-text-primary",children:e.jsx($,{date:a.created_at})})]}),e.jsxs("div",{id:"alertItemTitleAndDescription",children:[e.jsx("h1",{className:"text-xl font-bold text-white m-0",children:(r=j(a))==null?void 0:r.title}),e.jsx("p",{className:"text-white text-base m-0 leading-none",children:(v=j(a))==null?void 0:v.message})]})]})})}),c?e.jsx("div",{id:"btn",className:"z-50 w-fit",children:e.jsx("span",{onClick:()=>{p(a),h("/support-nurnt/dashboard/alarm-detail",{state:{alertData:a,id:a==null?void 0:a.elderly_id}})},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"View Alert"})}):e.jsx("div",{id:"rightSide",className:"z-50 w-fit",children:e.jsx("span",{onClick:()=>{p(a),g(!0)},className:"text-sm p-2 px-3 bg-white rounded-xl text-text-primary cursor-pointer hover:bg-white/90 transition-all duration-300 text-nowrap",children:"Mark as Complete"})}),e.jsx("img",{src:z,alt:"",className:"absolute top-0 right-0"})]})},A)})})}),e.jsx(V,{openAlertCloseModal:f,setOpenAlertCloseModal:g,selectedAlert:u,getAlertListDatas:()=>{x(),t()}})]})}function re({data:t={}}){var g,u,p,n,s,d,h,i;const o=I();l.useState(null);const c=l.useRef(null);l.useRef(!1),l.useState(!1);const f=m=>{switch(m){case"Info":return"bg-blue-500";case"Critical":return"bg-red-500";case"Warning":return"bg-yellow-500";default:return"bg-blue-500"}};return l.useEffect(()=>{var x;const m=(x=t==null?void 0:t.rooms)==null?void 0:x.device_no;return m&&(c.current&&c.current!==m&&L({uid:c.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(w=>console.error(`Error unsubscribing: ${w}`)),J({uid:m,messageType:["1","2","3","4"],topics:{pub:[m]}}).then(()=>{}).catch(w=>console.error(`Error subscribing: ${w}`)),c.current=m),()=>{c.current&&L({uid:c.current,messageType:["1","2","3","4"]}).then(()=>{}).catch(w=>console.error(`Error during cleanup unsubscribe: ${w}`))}},[t]),e.jsxs("div",{className:"w-full flex flex-col gap-4 p-4 pr-0 h-full pt-0",children:[e.jsxs("div",{id:"roomAlertHeader",className:`alert-header !h-[75px] flex justify-between items-center relative px-4 overflow-hidden rounded-lg ${f((g=j(t))==null?void 0:g.label)}`,children:[e.jsx("div",{className:"loader"}),e.jsxs("div",{className:"text-container flex flex-col gap-0 h-full justify-center text-white",children:[e.jsx("p",{className:"text-sm text-gray-100 m-0 font-medium",children:t.room_name}),e.jsx("h2",{className:"text-lg font-bold m-0 leading-none ",children:(u=j(t))==null?void 0:u.title})]}),e.jsx("span",{onClick:()=>{o(`/supporter/elderlies/elderly-profile/${t==null?void 0:t.elderly_id}`)},className:"text-sm text-gray-100 cursor-pointer p-3 py-2 bg-white/0 rounded-lg hover:bg-white/10 transition-all duration-300",children:"View Elderly"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-0 border-b border-gray-200 pb-2 ",children:[e.jsx("h2",{className:"text-lg font-bold m-0 leading-none",children:t.elderly_name}),e.jsx("p",{className:"text-sm text-gray-500 m-0",children:t.address})]}),e.jsx("div",{})]}),e.jsxs("div",{id:"roomMapAndDetails",className:"flex gap-4 h-full overflow-hidden",children:[e.jsx(U,{deviceId:(p=t==null?void 0:t.rooms)==null?void 0:p.device_no,children:e.jsxs("div",{className:"map-container w-2/3 border overflow-hidden h-full",children:[((n=t==null?void 0:t.rooms)==null?void 0:n.mount_type)===1&&((s=t==null?void 0:t.rooms)==null?void 0:s.is_device_bind)&&e.jsx(D,{roomInfo:t==null?void 0:t.rooms}),((d=t==null?void 0:t.rooms)==null?void 0:d.mount_type)===2&&((h=t==null?void 0:t.rooms)==null?void 0:h.is_device_bind)&&e.jsx(G,{roomInfo:t==null?void 0:t.rooms}),!((i=t==null?void 0:t.rooms)!=null&&i.is_device_bind)&&e.jsx("span",{className:"w-full h-full flex items-center justify-center",children:e.jsx("p",{children:" No Device Data Available"})})]})}),e.jsxs("div",{className:"details-container w-1/3 ",children:[e.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[e.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:F(t.created_at)}),e.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Time of Incident"})]}),e.jsxs("div",{className:"flex flex-col gap-0 p-3",children:[e.jsx("h2",{className:"text-xl font-bold m-0 leading-none",children:e.jsx($,{date:t.created_at})}),e.jsx("p",{className:"text-sm text-gray-500 m-0 font-medium",children:"Alert Life"})]})]})]})]})}const{Panel:ae}=B;function me(){l.useContext(E);const{notificationEvent:t}=W();l.useState("All");const[o,c]=l.useState([]),[f,g]=l.useState(null),[u,p]=l.useState(null),[n,s]=l.useState(null),[d,h]=l.useState(!1),[i,m]=l.useState(1),[x,w]=l.useState(!0),_=l.useRef(null),a=l.useCallback(()=>{!x||d||(h(!0),R({to_date:"2024-11-30",from_date:b().format("YYYY-MM-DD"),is_resolved:!1,limit:20,show_device_area:1,show_device_boundaries:1,page:i,...n}).then(r=>{c(v=>[...v,...r.data]),i>=r.totalPages&&w(!1),h(!1)}).catch(r=>{console.error(r),h(!1)}))},[n,i,x,d]);l.useEffect(()=>{a()},[i,n]),l.useEffect(()=>{if(o.length>0&&!f){const r=o[0];g(r._id),p(r)}},[o,f]);const A=r=>{g(r);const v=o.find(y=>y._id===r);p(v)},M=l.useCallback(ne(()=>{if(!_.current||d||!x)return;const{scrollTop:r,scrollHeight:v,clientHeight:y}=_.current;r+y>=v-50&&m(S=>S+1)},200),[d,x]),N=r=>{s(P(r)),m(1),c([]),w(!0)};l.useEffect(()=>{t&&a()},[t]),l.useEffect(()=>{const r=_.current;return r&&r.addEventListener("scroll",M),()=>{r&&r.removeEventListener("scroll",M)}},[M]);const C=l.useMemo(()=>o.reduce((r,v)=>{const y=v.room_name;return r[y]||(r[y]=[]),r[y].push(v),r},{}),[o]),k=r=>{switch(r){case"Critical":return"red";case"Warning":return"orange";case"Info":return"blue";default:return"gray"}};return e.jsxs("div",{className:"w-full flex justify-center items-center h-[495px] overflow-hidden",children:[e.jsxs("div",{className:"w-[30%] flex flex-col gap-4 h-full",children:[e.jsx(Q,{style:{width:"100%"},block:!0,options:ie,onChange:r=>N(r)}),e.jsxs("div",{ref:_,className:"w-full overflow-auto",style:{height:"440px"},children:[o.length===0&&!d&&e.jsx(Y,{description:"No active alerts available"}),o.length>0&&e.jsx(B,{children:Object.entries(C).map(([r,v])=>([...new Set(v.map(y=>{var S;return(S=j(y))==null?void 0:S.label}))],e.jsx(ae,{header:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("span",{className:"text-black font-semibold",children:r})}),children:v&&v.map(y=>{var S;return e.jsxs("div",{onClick:()=>A(y._id),className:`flex justify-between items-center p-2 cursor-pointer rounded-md px-4 ${f===y._id?"bg-gray-100":""}`,children:[e.jsx("span",{className:"text-[14px] font-semibold",children:b(y.created_at).format("hh:mm:ss a")}),e.jsx(q,{color:k((S=j(y))==null?void 0:S.label),size:"large"})]},y._id)})},r)))}),d&&e.jsx("div",{className:"w-full flex justify-center py-4",children:e.jsx(K,{})}),!x&&o.length>0&&e.jsx("div",{className:"w-full text-center py-4 text-gray-500",children:"No more alerts to load"})]})]}),e.jsx("div",{className:"w-[70%] h-full",children:u?e.jsx(re,{data:u}):e.jsx(Y,{description:"Select an alert to view details"})})]})}const ie=[{label:"All",value:"All"},{label:"Critical",value:"Critical"},{label:"Warning",value:"Warning"},{label:"Info",value:"Info"}];function oe({data:t=[],fromDate:o,toDate:c}){const u=((n,s)=>{const d=[];let h=b(n);for(;h.isBefore(s)||h.isSame(s,"day");)d.push(h.format("YYYY-MM-DD")),h=h.add(1,"day");return d})(o,c).map(n=>{const s=t.filter(i=>i.date===n&&i.alarm_group==="Critical").reduce((i,m)=>i+m.count,0),d=t.filter(i=>i.date===n&&i.alarm_group==="Warning").reduce((i,m)=>i+m.count,0),h=t.filter(i=>i.date===n&&i.alarm_group==="Info").reduce((i,m)=>i+m.count,0);return{day:b(n).format("ddd"),critical:s,warning:d,problem:h}}),p={tooltip:{trigger:"axis"},grid:{left:"0%",right:"0%",bottom:"20%",top:"10%",containLabel:!0},legend:{show:!0,orient:"horizontal",bottom:"10%"},xAxis:{type:"category",data:u.map(n=>n.day)},yAxis:{type:"value"},series:[{name:"Critical",type:"line",data:u.map(n=>n.critical),itemStyle:{color:"#FF0000"},smooth:!0},{name:"Warning",type:"line",data:u.map(n=>n.warning),itemStyle:{color:"#FFA500"},smooth:!0},{name:"Problem",type:"line",data:u.map(n=>n.problem),itemStyle:{color:"#800080"},smooth:!0}]};return t.length?e.jsx(X,{option:p,style:{width:"100% !important",height:"100%"}}):e.jsx("div",{className:"h-full flex items-center w-full justify-center",children:e.jsx(Y,{description:"No data available to show"})})}b.extend(Z);b.extend(ee);const de=({placeholder:t,style:o,handleChange:c,value:f})=>{const[g,u]=l.useState("This Week"),p=s=>{const d=b(s).startOf("week").format("YYYY-MM-DD"),h=b(s).endOf("week").format("YYYY-MM-DD");return{week:b(s).week(),start:d,end:h}},n=s=>`Week ${p(s).week}`;return l.useEffect(()=>{if(f){const s=b().week(),d=b(f.start).week();d===s-1?u("Last Week"):u(`Week ${d}`)}else u("This Week")},[f]),e.jsx(te,{style:o,placeholder:g,size:"large",format:n,picker:"week",onChange:s=>{if(s){const d=p(s);c(d)}else c(""),u("This Week")}})},T=t=>{const o=["Critical","Info","Warning"],c=["Living Room","Kitchen","Bedroom","Bathroom"],f=["John Doe","Jane Doe","Alice Smith","Bob Johnson","Emma Brown","Michael Wilson","Sarah Davis","David Miller","Lisa Garcia","James Rodriguez"],g=["Fall Detected","Fire Detected","Inactivity Alert","Medication Reminder","Unusual Behavior","High Temperature","Low Temperature","Water Leak","Door Left Open","Window Broken"],u=["Medication Taken","Medication Not Taken","Medication Reminder"],p=["Wheelchair","Crutches","Cane","None"],n=["Yes","No"],s=["Yes","No"],d=["Yes","No"],h=["1","4","2","No"],i=["True","False"];return Array.from({length:t},(m,x)=>({_id:x+1,alertType:o[Math.floor(Math.random()*o.length)],elderlyName:f[Math.floor(Math.random()*f.length)],alertName:g[Math.floor(Math.random()*g.length)],roomId:String(x+1),roomName:c[Math.floor(Math.random()*c.length)],alertLifetime:`${Math.floor(Math.random()*10)}m ${Math.floor(Math.random()*60)}s`,time:new Date().toLocaleString(),alertDescription:`${g[Math.floor(Math.random()*g.length)]} in the ${c[Math.floor(Math.random()*c.length)]}`,status:"Active",isAlert:i[Math.floor(Math.random()*i.length)],address:"123 Main St, Anytown, USA",coordinates:{latitude:37.7749+(Math.random()-.5)*.01,longitude:-122.4194+(Math.random()-.5)*.01},closedAt:new Date().toLocaleString(),closedBy:f[Math.floor(Math.random()*f.length)],eventName:u[Math.floor(Math.random()*u.length)],disabilityType:p[Math.floor(Math.random()*p.length)],additionalInfo:"This is additional info for event",hospital:{name:"Hospital For Special Surgery",phone:"1234567890",latitude:-33.8743612,longitude:151.2261153},allergies:n[Math.floor(Math.random()*n.length)],diseases:s[Math.floor(Math.random()*s.length)],medications:d[Math.floor(Math.random()*d.length)],activeAlert:h[Math.floor(Math.random()*h.length)],alertComments:"This is alert comments",alertLifespan:[{dateTime:"24-01-2024 10:00 AM",description:"At 10:00 AM, the alert was created"},{dateTime:"24-01-2024 10:30 AM",description:"Agent (petar) clicked on the incident in 10:30 (30mins later)"},{dateTime:"24-01-2024 10:32 AM",description:"Agent (petar) clicked on “Call Elderly” in 10:32 (2mins later)"},{dateTime:"24-01-2024 10:34 AM",description:"Agent (petar) clicked on “Call 911” in 10:34 (2mins later)"},{dateTime:"24-01-2024 10:36 AM",description:"Agent (petar) clicked on “Close Alert” in 10:36 (2mins later)"}]}))};T(14);T(20);T(20);T(20);T(20);function pe(){const[t,o]=l.useState(b().subtract(6,"days").format("YYYY-MM-DD")),[c,f]=l.useState(b().format("YYYY-MM-DD")),[g,u]=l.useState([]),p=l.useCallback(()=>{se({from_date:c,to_date:t}).then(s=>{u(s==null?void 0:s.data)}).catch(s=>{console.log(s)})},[c]);l.useEffect(()=>{p()},[p]);function n(s){s?(o(s.start),f(s.end)):(o(b().subtract(6,"days").format("YYYY-MM-DD")),f(b().format("YYYY-MM-DD")))}return e.jsxs("div",{className:"w-full h-full",children:[e.jsxs("div",{id:"ChartHeader",className:"w-full flex justify-between",children:[e.jsx("h1",{className:"text-[24px] font-bold",children:"Overview"}),e.jsx("div",{id:"chartController",className:"flex gap-4",children:e.jsx(le,{theme:{token:{fontFamily:"Baloo2",colorPrimary:"#8086AC",colorLinkActive:"#8086AC",colorLinkHover:"#8086AC",colorLink:"#8086AC"}},children:e.jsx(de,{style:{height:"fit-content"},handleChange:s=>n(s)})})})]}),e.jsx("div",{className:"w-full h-full",children:e.jsx(oe,{data:g,fromDate:t,toDate:c})})]})}export{fe as A,me as R,pe as a};
//# sourceMappingURL=alertsOverview-C_Gv9-0n.js.map
